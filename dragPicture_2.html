<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>页面拖拽</title>
     <style type="text/css">
    body{
        margin: 0;
        padding: 0;
    }
    .container{
        width: 100%;
        display: inline-block;
        background-color: rgba(3,4,5,.3);
    }
    .box ul{ 
        overflow: hidden;
        list-style: none;
        margin: 10px 10px;
        padding: 0;
    }
    .box li{
        float: left;
        width: 30%;
        margin-left:2.5% ;
        margin-top: 18px;
        line-height: 18px;
        background-color: #fff;
        border-radius: 20px;
    }
    .box img{
        display: block;
        border-radius: 20px;
        width: 90%;
        height: 90%;
        padding: 5%;

    }


    </style>
</head>
<body>
   
    <div class="container">
        <div class="box"><ul></ul></div>
    </div>


<script type="text/javascript">
var $ = function (id) {return typeof id === 'string' ? document.getElementById(id):id}
var $$ = function(tagName, oParent) { return (oParent||document).getElementsByTagName(tagName)}
var $$$ = function (sClass, oParent){
    var aClass = [],
    i = 0,
    reClass = new RegExp("(\\s)"+sClass+"($|\\s)"),
    aElement = $$("*",oParent);
    for (i = 0 ; i<aElement.length;i++)reClass.test(aElement[i].className&&aClass.push(aElement[i]));
        return aClass
}
function getPos(obj){
    var iTop = obj.offsetTop;
    var iLeft = obj.offsetLeft;
    while (obj.offsetParent){
        iTop +=obj.offsetParent.offsetTop;
        iLeft +=obj.offsetParent.offsetLeft;
        obj = obj.offsetParent;
    }
    return {top:iTop,left:iLeft}
}
var PhotoWall = function(){this.initialize.apply(this, arguments)};
PhotoWall.prototype = {
    initialize:function (obj, aData)
    {
        var oThis = this;
        this.oParent = $(obj);
        this.oUl = $$("ul",this.oParent)[0];
        this.oBtn = $$("a",this.oParent)[0];
        this.zIndex = 1;
        this.aPos = [];
        this.aData = aData;
        this.dom = document.documentElement ||document.body;
        this.create();
    },
    create:function()
    {
        var aFrag = document.createDocumentFragment();
        var i = 0;
        for(i = 0 ; i<this.aData.length;i++)
        {
            var oLi = document.createElement('li');
            var oImg = document.createElement('img');
            oImg.src = this.aData[i];
            oLi.appendChild(oImg);
            aFrag.appendChild(oLi);
        }
        this.oUl.appendChild(aFrag);
        this.aLi = $$("li",this.oParent);
        this.changeLayout();
    },
    changeLayout:function(){
        var i = 0;
        this.oParent.style.height = this.oParent.offsetHeight -2 +"px";
        this.aPos.length = 0;
        for(i = 0 ; i< this.aLi.height;i++ )this.aLi[i].style.cssText=""
        for(i = 0 ; i<this.aLi.height;i++)
        {
            this.aLi.index = i;
            this.aLi.style.top = getPos(this.aLi[i]).top+"px";
            this.aLi.style.left = getPos(this.aLi[i]).left+"px";
            this.aPos.push({left:getPos(this.aLi[i]).left,top:getPos(this.aLi[i].top)})
        }
        for(i = 0; i<this.aLi.length; i++ )
        {
            this.drag(this.aLi[i]);
        }
    },
    drag:function(obj,handle)
    {
        var oThis = this;
        var handle = handle||obj;
        handle.style.cursor = "move";
        handle.onmousedown = function(event)
        {
            var event = event||window.event;
            var disX = event.clientX - this.offsetLeft;
            var disY = event.clientY - this.offsetHeight;
            var oNear =null;
            handle.style.zIndex = oThis.zIndex++;
            document.onmousemove = function(event)
            {
                var event = event ||window.event;
                var iL = event.clientX - disX;
                var iT = event.clientY - disY;
                var maxL = Math.max(oThis.dom.clientWidth,oThis.dom.scrollWidth)-handle.offsetWidth;
                var maxT = Math.max(oThis.dom.clientHeight,oThis.dom.scrollHeight) - handle.offsetHeight;
                iL < 0 && (iL = 0);
                iT < 0 && (iT = 0);
                iL > maxL && (iL = maxL);
                iT > maxT && (iT = maxT);
                handle.style.left = iL+"px";
                handle.style.top = iT +"px";
                oNear = oThis.findNearest(obj);
                for (var i = 0 ;i <oThis.aLi.length;i++) oThis.aLi[i].className = "";
                    oNear && (oNear.className = "hig");
                return false;
            };
            document.onmouseup = function()
            {
                document.onmousemove = null;
                document.onmouseup = null;
                if(oNear)
                {
                    handle.index = [handle.index,oNear.index];
                    oNear.index = handle.index[0];
                    handle.index = handle.index[1];
                    oNear.style.zIndex = oThis.zIndex++;
                    oThis.doMove(handle, oThis.aPos[handle.index]);
                    oThis.doMove(oNear,oThis.aPos[handle.index]);
                    oNear.className ='';

                }
                else
                {
                    oThis.doMove(handle, oTHis.aPos[handle.index]);
                }
                this.releaseCapture&& handle.releaseCapture();
                return false;

            }
        }
    
    },    doMove:function (obj,iTarget ,callback)
        {
            var oThis = this;
            clearInterval(obj.timer);
            obj.timer = setInterval(function()
            {
                var iCurL = getPos(obj).left;
                var iCurT = getPos(obj).top;
                var iSpeedL = (iTarget.left - iCurL)/5;
                var iSpeedT = (iTarget.top - iCurT)/5
                iSpeedL = iSpeedL >0 ? Math.ceil(iSpeedL):Math.floor(iSpeedL);
                iSpeedT = iSpeedT >0 ? Math.ceil(iSpeedT):Math.floor(
                    iSpeedT);
                if (iCurL == iTarget.left && iCurT == iTarget.top)
                {
                    clearInterval(obj.timer);
                    callback&&callback();
                }
                else
                {
                    obj.style.left = iCurL +iSpeedL+"px";
                    obj.style.top = iCurT +iSpeedT+"px";
                }
            },30)
        },
        findNearest:function(obj){
            var aDistance =[];
            var i =0;
            for(i = 0 ; i<this.aLi.length ; i++) aDistance[i] = this.aLi[i] ===obj ? Number.MAX_VALUE :this.getDistance(obj,this.aLi[i]);
                var minMun  = Number.MAX_VALUE;
            var minIndex = -1;
            for(i =0 ; i <aDistance.length ; i++) aDistance[i]<minMun&&(minMun = aDistance[i],minIndex = i);
                return this.isButt(obj,this.aLi[minIndex])? this.aLi[minIndex]:null;
        },
        getDistance: function(obj1, obj2)
    {
        var a = (obj1.offsetLeft + obj1.offsetWidth / 2) - (obj2.offsetLeft + obj2.offsetWidth / 2);
        var b = (obj1.offsetTop + obj1.offsetTop / 2) - (obj2.offsetTop + obj2.offsetTop / 2);
        return Math.sqrt(a * a + b * b)
    },isButt: function (obj1, obj2)
    {
        var l1 = obj1.offsetLeft;
        var t1 = obj1.offsetTop;
        var r1 = l1 + obj1.offsetWidth;
        var b1 = t1 + obj1.offsetHeight;
        
        var l2 = obj2.offsetLeft;
        var t2 = obj2.offsetTop;
        var r2 = l2 + obj2.offsetWidth;
        var b2 = t2 + obj2.offsetHeight;
        
        return !(r1 < l2 || b1 < t2 || r2 < l1 || b2 < t1)
    }

}


window.onload = function (){
    // console.log($$$("box"))
    var aBox = $$$("box");
    var aData = [];
    var aExample = [];
    var i = 0;
    for( i = 1 ;i<22 ; i++) aData[aData.length] = "images/-__("+i+").jpg";
    for( i = 0 ; i < aBox.length ;i++)
    {
        var oExample = new PhotoWall(aBox[i],aData);
        aExample.push(oExample);
    }
    this.onreasize = function()
    {
        for (var p in aExample) aExample[p].changeLayout();
    }
    this.onreasize();
}

</script>

</body>
</html>